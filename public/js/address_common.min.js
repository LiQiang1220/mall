ec.pkg("ec.address");ec.load("ajax");ec.load("ec.dh");ec.load("ec.aes");var _defaultAddress="\u9009\u62e9\u7701-\u5e02-\u533a-\u8857\u9053";var _defaultTimeOut=10000;var address=[];var tree_url=domainShoppingConfig+"/data/region/tree/{id}.json";var children_url=domainShoppingConfig+"/data/region/children/{id}.json";var _tempAddress={};var _tempAddressIds={};var addressConfig=null;var cache={},ajaxer;var timeoutId;ec.address.parseUrl=function(a,b){return a.replace(/{id}/g,b)};ec.address.processAddress=function(){var b=$("#current-address").text();var g="0";if(b==_defaultAddress){_tempAddressIds={};_tempAddress={}}var d=1;var a=_tempAddress[0],e=_tempAddress[1],c=_tempAddress[2],f=_tempAddress[3];if(a!=null&&a!=""){$("#provice").html(a);if(e!=undefined&&e.length>0){$("#city").html(e);if(c!=undefined&&c.length>0){$("#district").html(ec.address.replaceChar(c));if(f!=undefined&&f.length>0){$("#street").html(ec.address.replaceChar(f));g=$("#myAddress-form").find("input[name=district]").val();d=4}else{d=3;$("#street").hide();g=$("#myAddress-form").find("input[name=city]").val()}}else{d=2;$("#district").hide();g=$("#myAddress-form").find("input[name=city]").val()}}else{$("#city").hide();g="0"}}$("#provice_info").find("a").bind("click",ec.address.againSelectAddress);if(g=="0"||$.trim(g)==""){ec.address.queryData(ec.address.parseUrl(tree_url,g),true,d,ec.address.queryProvince)}else{ec.address.queryData(ec.address.parseUrl(children_url,g),true,d,ec.address.queryProvince)}};ec.address.againSelectAddress=function(){var c=$(this).attr("data-value");var a=parseInt($(this).attr("level-value"));if((c==null||c=="")&&a!=1){return}if($.trim($(this).text())=="\u8bf7\u9009\u62e9"){return}$(".form-address-name-tab").find("a:not(#street)").removeClass();switch(a){case 1:$("#provice").addClass("current");$("#city").html("\u8bf7\u9009\u62e9");$("#district").html("\u8bf7\u9009\u62e9");$("#street").html("\u8bf7\u9009\u62e9");$("#street").hide();_tempAddressIds[1]="";_tempAddressIds[2]="";_tempAddressIds[3]="";_tempAddress[1]="";_tempAddress[2]="";_tempAddress[3]="";$("#myAddress-form").find("input[name=city]").attr("value","");$("#myAddress-form").find("input[name=district]").attr("value","");$("#myAddress-form").find("input[name=street]").attr("value","");break;case 2:$("#city").addClass("current");$("#district").html("\u8bf7\u9009\u62e9");$("#street").html("\u8bf7\u9009\u62e9");$("#street").hide();_tempAddressIds[2]="";_tempAddressIds[3]="";_tempAddress[2]="";_tempAddress[3]="";$("#myAddress-form").find("input[name=district]").attr("value","");$("#myAddress-form").find("input[name=street]").attr("value","");break;case 3:$("#district").addClass("current");$("#street").html("\u8bf7\u9009\u62e9");_tempAddressIds[3]="";_tempAddress[3]="";$("#myAddress-form").find("input[name=street]").attr("value","");break;case 4:$("#street").addClass("current");break}if(a==1){ec.address.queryData(ec.address.parseUrl(tree_url,"0"),true,1,ec.address.queryProvince)}else{var b=parseInt(c);ec.address.queryData(ec.address.parseUrl(children_url,b),true,a,ec.address.queryProvince)}};ec.address.changeAddress=function(){var c=$(this).attr("id");var a=ec.address.replaceChar($(this).text());var b=parseInt($(this).attr("addrType"));$(".form-address-name-tab").find("a:not(#street)").removeClass();switch(b){case 1:$("#provice").html(a);$("#city").attr("data-value",c);$("#city").addClass("current");$("#myAddress-form").find("input[name=province]").attr("value",c);_tempAddress[0]=$(this).text();_tempAddressIds[0]=c;break;case 2:$("#city").html(a);$("#district").attr("data-value",c);$("#district").addClass("current");$("#myAddress-form").find("input[name=city]").attr("value",c);_tempAddress[1]=$(this).text();_tempAddressIds[1]=c;break;case 3:$("#district").html(a);$("#street").attr("data-value",c);$("#street").addClass("current");$("#myAddress-form").find("input[name=district]").attr("value",c);_tempAddress[2]=$(this).text();_tempAddressIds[2]=c;break;case 4:$("#street").html(a);$("#street").attr("data-value",c);$("#street").addClass("current");$("#myAddress-form").find("input[name=street]").attr("value",c);$("#address-tab").hide();_tempAddress[3]=$(this).text();_tempAddressIds[3]=c;break}if(b<4){ec.address.queryData(ec.address.parseUrl(children_url,c),true,b+1,ec.address.queryProvince)}else{if(_tempAddress!=null&&_tempAddressIds!=null){ec.address.showAddress(_tempAddress)}}};ec.address.queryProvince=function(f,g){var b;if(g==1){b=f.data[0]}else{b=f.data}var c=[];var e=b.length;if(e>0){if(g==4){$("#street").show()}else{$("#street").removeClass("current");$("#street").html("\u8bf7\u9009\u62e9")}c.push('<ul class="clearfix">');var a=0;for(var d=0;d<e;d++){var h=ec.address.replaceChar(b[d].name);c.push('<li id="'+b[d].id+'" addrType="'+g+'"><a href="javascript:;">'+h+"</a></li>")}c.push("</ul>");$("#address_table").css({"min-height":"180px"}).html(c.join(""));$("#address_table").find("li").bind("click",ec.address.changeAddress);$("#address-tab").show()}else{if(g==4){$("#street").hide();$("#district").addClass("current");$("#myAddress-form").find("input[name=needL4Addr]").attr("value",false);ec.address.showAddress(_tempAddress)}}};ec.address.queryData=function(a,c,d,e){var b;if(c&&(b=cache[a])){return e(b,d)}if(ajaxer){ajaxer.abort()}ajaxer=$.ajax({url:a,type:"get",dataType:"jsonp",success:function(f){if(c){cache[a]=f}e(f,d)},error:function(g,f){logger.warn("load data fail.")}})};ec.address.getCitydistrict=function(f){_tempAddress={};var j=f.values;var a="";var b=f.data[0];for(var d=0;d<b.length;d++){var h=b[d];if(h.id==j[0]){_tempAddress[0]=h.name;$("#myAddress-form").find("input[name=province]").attr("value",h.id);a="provice";break}}var c=f.data[1];for(var d=0;d<c.length;d++){var h=c[d];if(h.id==j[1]){_tempAddress[1]=h.name;$("#myAddress-form").find("input[name=city]").attr("value",h.id);a="city";break}}var g=f.data[2];for(var d=0;d<g.length;d++){var h=g[d];if(h.id==j[2]){_tempAddress[2]=h.name;$("#myAddress-form").find("input[name=district]").attr("value",h.id);a="district";break}}var e=f.data[3];if($.trim(e)!=""&&e!=undefined){for(var d=0;d<e.length;d++){var h=e[d];if(h.id==j[3]){_tempAddress[3]=h.name;$("#myAddress-form").find("input[name=street]").attr("value",h.id);a="street";break}}}$("#"+a).addClass("current").siblings().removeClass("current");ec.address.showAddress(_tempAddress)};ec.address.getAddressIdCallBack=function(b){var a=b.districtId;if($.trim(a)==""){ec.address.hiddenTips();return}ec.address.showAddress(_tempAddress)};ec.address.showAddress=function(a){$("#current-address").addClass("form-address-detailcon");var b=a[0]+"-"+a[1]+"-"+ec.address.replaceChar(a[2]);var c=ec.address.replaceChar(a[3]);if($.trim(c)!=""&&c!=undefined){b+="-"+c}$("#current-address").html(b);ec.address.hiddenTips();$("#myAddress-msg").hide();$("#myAddress-msg").removeClass()};ec.address.hiddenTips=function(){$("#address-search").hide();$("#address-tab").hide()};ec.address.setDefaultAddress=function(){$("#current-address").html(_defaultAddress)};ec.address.change=function(a){switch(a){case 1:$("#address-tab").hide();$("#address-search").show();break;case 2:$("#address-tab").show();if($("#gouldAddress").val()==1){ec.address.processAddress()}$("#address-search").hide();break}};ec.address.oSearchSuggest=function(c){var a=$("#address-search input");var d=$(".form-address-search-list");var b="";var e=function(){a.bind("keyup",ec.address.sendKeyWord)};ec.address.sendKeyWord=function(i){if(d.css("display")=="block"&&i.keyCode==38||i.keyCode==40){var j=d.find("li p.hover");if(i.keyCode==38){if(j.length>0){var l=j.removeClass("hover").prev();if(l.length>0){l.addClass("hover");a.val(l.html())}}else{var h=d.find("li p:last");h.addClass("hover");a.val(h.html())}}else{if(i.keyCode==40){if(j.length>0){var g=j.removeClass("hover").next();if(g.length>0){g.addClass("hover");a.val(g.html())}}else{var k=d.find("li p:first");k.addClass("hover");a.val(k.html())}}}}else{var f=$.trim(a.val());if(f==""||f==b){$("#form-address-no").hide();return}clearTimeout(timeoutId);timeoutId=setTimeout(function(){c(f)},300);b=f}};this.dataDisplay=function(f){if(f.length<=0){d.hide();return}d.find("li p").hover(function(){$(this).parent().find("span").show();d.find("li").removeClass("hover");$(this).find("li").addClass("hover");a.val(this.innerHTML)},function(){$(this).removeClass("hover");$(this).parent().find("span").hide()}).bind("click",function(){a.val(this.innerHTML);d.hide()})};e()};ec.address.location=function(d){var a=d;var c={location:d};$.ajax({type:"GET",url:domainShoppingConfig+"/data/getRegionInfoByLocation.json",async:false,data:c,dataType:"jsonp",success:function(e){if($.trim(e)!=""&&e!=undefined){b(e);$("#address-search").hide()}else{$("#form-address-no").show()}}});function b(f){$("#form-address-no").hide();if(f.success){if(($.trim(f.provinceId)!=""&&f.provinceId!=undefined)&&($.trim(f.cityId)!=""&&f.cityId!=undefined)&&($.trim(f.districtId)!=""&&f.districtId!=undefined)&&((f.needL4Addr!="")&&(f.needL4Addr))){var g=ec.address.replaceChar(f.streetName);if($.trim(g)!=""&&g!=undefined){$("#current-address").empty();$("#current-address").addClass("form-address-detailcon");$("#myAddress-form").find("input[name=province]").attr("value",f.provinceId);$("#myAddress-form").find("input[name=city]").attr("value",f.cityId);$("#myAddress-form").find("input[name=district]").attr("value",f.districtId);$("#city").attr("data-value",f.provinceId);$("#district").attr("data-value",f.districtId);var e=f.provinceName+"-"+f.cityName+"-"+ec.address.replaceChar(f.districtName)+"-"+g;$("#myAddress-form").find("input[name=street]").attr("value",f.streetId);$("#street").attr("data-value",f.street);$("#myAddress-form").find("input[name=needL4Addr]").attr("value",f.needL4Addr);$("#current-address").html(e)}else{ec.address.goSelectAddress(f)}}else{ec.address.goSelectAddress(f)}}else{_tempAddress={};$(".form-address-name-tab").find("a:not(#street)").removeClass();ec.address.defaultTabValue();ec.address.cleanValue();ec.address.change(2)}}$("#myAddress-msg").hide();$("#myAddress-msg").removeClass()};ec.address.goSelectAddress=function(a){_tempAddress={};$(".form-address-name-tab").find("a:not(#street)").removeClass();ec.address.defaultTabValue();ec.address.cleanValue();ec.address.change(2);var c=1;var b="0";if($.trim(a.districtId)!=""&&a.districtId!=undefined){c=3;b=a.districtId;$("#myAddress-form").find("input[name=province]").attr("value",a.provinceId);$("#myAddress-form").find("input[name=city]").attr("value",a.cityId);$("#myAddress-form").find("input[name=district]").attr("value",a.districtId);_tempAddress[0]=a.provinceName;_tempAddress[1]=a.cityName;_tempAddress[2]=a.districtName;$("#provice").html(a.provinceName);$("#city").html(a.cityName);$("#district").html(a.districtName);$("#city").attr("data-value",a.provinceId);$("#district").attr("data-value",a.districtId);$("#district").addClass("current");_tempAddressIds[0]=a.provinceId;_tempAddressIds[1]=a.cityId;_tempAddressIds[2]=a.districtId;$("#district").attr("data-value",a.cityId)}else{if($.trim(a.cityId)!=""&&a.cityId!=undefined){c=2;b=a.cityId;$("#myAddress-form").find("input[name=province]").attr("value",a.provinceId);$("#myAddress-form").find("input[name=city]").attr("value",a.cityId);_tempAddress[0]=a.provinceName;_tempAddress[1]=a.cityName;$("#provice").html(a.provinceName);$("#city").html(a.cityName);$("#city").attr("data-value",a.provinceId);$("#city").addClass("current");_tempAddressIds[0]=a.provinceId;_tempAddressIds[1]=a.cityId;$("#city").attr("data-value",a.provinceId)}else{if($.trim(a.provinceId)!=""&&a.provinceId!=undefined){c=0;b=a.provinceId;$("#myAddress-form").find("input[name=province]").attr("value",a.provinceId);_tempAddress[0]=a.provinceName;$("#provice").html(a.provinceName);$("#provice").addClass("current");_tempAddressIds[0]=a.provinceId}else{c=0}}}ec.address.setValue(a);ec.address.queryData(ec.address.parseUrl(children_url,parseInt(b)),true,c+1,ec.address.queryProvince)};ec.address.sendKeyWordToBack=function(b){var a=b.length;if(a<2){$("#form-address-no").show();$("#address-search .form-address-search-list ul").hide()}else{$("#form-address-no").hide();$("#address-search .form-address-search-list ul").show();var c={keywords:b};$.ajax({type:"GET",url:domainShoppingConfig+"/data/searchByKeywords.json",async:false,data:c,dataType:"jsonp",success:function(f){var e=f.data;if($.trim(e)!=""&&e!=undefined){d(f.data)}else{$("#address-search .form-address-search-list ul").empty();$("#form-address-no").show()}}})}function d(e){$("#form-address-no").hide();$("#address-search .form-address-search-list ul").empty();$.each(e,function(f,g){$("#address-search .form-address-search-list ul").append("<li><p>"+g.name+"</p><span>"+g.provinceName+g.cityName+g.distinctName+'</span><a href="javascript:;" onclick=ec.address.location(\''+g.location+"')>\u9009\u62e9</a></li>")})}};ec.address.cleanKeyWord=function(){$("#address-search input").val("")};ec.address.bindSeelctEvent=function(){new ec.address.oSearchSuggest(ec.address.sendKeyWordToBack);$("#current-address").bind("click",function(){if($("#gouldAddress").val()==0){ec.address.processAddress()}else{$("#address-search").show()}});$(".btn-address-close").bind("click",function(){ec.address.hiddenTips()});$(".form-address-search-text a").click(function(){ec.address.cleanKeyWord()})};ec.address.setValue=function(a){if(a.province!=undefined&&a.province!=""){_tempAddress[0]=a.provinceName;_tempAddressIds[0]=a.province}if(a.city!=undefined&&a.city!=""){_tempAddress[1]=a.cityName;_tempAddressIds[1]=a.city;$("#city").attr("data-value",a.province)}if(a.district!=undefined&&a.district!=""){_tempAddress[2]=a.districtName;_tempAddressIds[2]=a.district;$("#district").attr("data-value",a.city)}if(a.street!=undefined&&a.street!=""){_tempAddress[3]=a.streetName;_tempAddressIds[3]=a.street;$("#street").attr("data-value",a.street)}};ec.address.defaultTabValue=function(){$("#provice").html("\u8bf7\u9009\u62e9");$("#city").html("\u8bf7\u9009\u62e9");$("#district").html("\u8bf7\u9009\u62e9");$("#street").html("\u8bf7\u9009\u62e9");$("#street").hide();$(".form-address-name-tab").find("a").removeClass()};ec.address.cleanValue=function(){address=[];_tempAddress={};_tempAddressIds={}};ec.address.cleanFormValue=function(){$("#myAddress-form").find("input[name=province]").attr("value","");$("#myAddress-form").find("input[name=city]").attr("value","");$("#myAddress-form").find("input[name=district]").attr("value","");$("#myAddress-form").find("input[name=street]").attr("value","")};ec.address.replaceChar=function(a){if(a!=null&&a!=""&&a=="-"){return"\u5176\u5b83\u5730\u533a"}else{return a}};ec.address.query=function(a,c,d){var b;if(c&&(b=cache[a])){return d(b)}if(ajaxer){ajaxer.abort()}ajaxer=$.ajax({url:a,type:"get",dataType:"jsonp",success:function(e){if(c){cache[a]=e}d(e)},error:function(f,e){logger.warn("load data fail.")}})};ec.address.format=function(e){var a,g,f,h;$("input[name='province']").val(e.values[0]);$("input[name='city']").val(e.values[1]);$("input[name='district']").val(e.values[2]);$("input[name='street']").val(e.values[3]);for(var d=0;d<e.data.length;d++){for(var c=0;c<e.data[d].length;c++){if(e.data[d][c].id==e.values[0]){a=e.data[d][c].name;break}if(e.data[d][c].id==e.values[1]){g=e.data[d][c].name;break}if(e.data[d][c].id==e.values[2]){f=e.data[d][c].name;break}if(e.data[d][c].id==e.values[3]){h=e.data[d][c].name;break}}}var b=a+"&nbsp;&gt;&nbsp;"+g+"&nbsp;&gt;&nbsp;"+ec.product.replaceChar(f);if(h!=null){b=b+"&nbsp;&gt;&nbsp;"+ec.product.replaceChar(h)}$("#address").find("a").html(b)};
