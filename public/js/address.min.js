ec.pkg("ec.member.myAddress");ec.load("ajax");ec.load("ec.box");ec.load("ec.linkSelect.region");ec.load("ec.dh");ec.load("ec.aes");ec.load("ec.rc4");ec.member.myAddress.data={};ec.member.myAddress.list=function(a,d){var c,b=[];$("#randomFlag").val(d);if(a.length<0){$("#myAddress-record").hide();return}for(c=0;c<a.length;c++){ec.member.myAddress.data[a[c].id]=a[c];b.push('<div class="list-group-item" id="myAddress-area-'+ec.util.escapeHtml(a[c].id)+'">');b.push('<table border="0" cellpadding="0" cellspacing="0">');b.push("<tbody><tr>");b.push('<td class="col-name">'+ec.util.escapeHtml(a[c].consignee)+"</td>");b.push('<td class="col-address">'+ec.util.escapeHtml(a[c].provinceName)+"&nbsp;&nbsp;"+ec.util.escapeHtml(a[c].cityName)+"&nbsp;&nbsp;"+ec.util.escapeHtml(a[c].districtName)+"&nbsp;&nbsp;");if(a[c].streetName!=null&&a[c].streetName!=""){b.push(ec.util.escapeHtml(a[c].streetName)+"&nbsp;&nbsp;")}b.push(ec.util.escapeHtml(a[c].address)+"</td>");b.push('<td class="col-zip">');if(a[c].zipCode){b.push(ec.util.escapeHtml(a[c].zipCode))}b.push("</td>");b.push('<td class="col-tel">');if(a[c].mobile&&a[c].mobile!=""){b.push("<p>"+ec.util.escapeHtml(a[c].mobile)+"</p>")}if(a[c].phone&&a[c].phone!=""){b.push("<p>"+ec.util.escapeHtml(a[c].phone)+"</p>")}b.push("</td>");b.push('<td class="col-operate"><p class="p-edit">');b.push('<a class="edit" href="javascript:;" onclick="ec.member.myAddress.edit('+ec.util.escapeHtml(a[c].id)+');" title="\u7f16\u8f91"><span>\u7f16\u8f91</span></a>');b.push('</p><p class="p-del">');b.push('<a class="del" href="javascript:;" onclick="ec.member.myAddress.del(this,'+ec.util.escapeHtml(a[c].id)+');" title="\u5220\u9664"><span>\u5220\u9664</span></a>');b.push('</p><p class="p-state">');if(a[c].defaultFlag==1){ec.member.myAddress.defaultId=a[c].id;b.push('<span class="default">\u9ed8\u8ba4\u5730\u5740</span>')}else{b.push('<a class="set " href="javascript:;" onclick="ec.member.myAddress.setDefault('+ec.util.escapeHtml(a[c].id)+')" title="\u8bbe\u4e3a\u9ed8\u8ba4\u6536\u8d27\u5730\u5740"><span>\u8bbe\u4e3a\u9ed8\u8ba4</span></a>')}b.push("</p></td></tr></tbody></table></div>")}$("#list-group").html(b.join(""));$("#myAddress-record").show()};ec.member.myAddress.save=function(c){var a=$(c);var b="update";if(a.attr("data-type")=="add"){b="add"}ec.addr.save(c,{type:b,successFunction:function(){var e=a.find("input[name=id]").val();var d=$("#button-ok").val();$("#current-address").removeClass("form-address-detailcon").addClass("form-address-detail");new ec.box($("#success-tips").val(),{boxclass:"ol_box_4",showCancel:false,onopen:function(f){if(d=="\u6dfb\u52a0\u65b0\u5730\u5740"){f.find(".b p").html("\u606d\u559c\u60a8\uff0c\u5df2\u6210\u529f\u6dfb\u52a0\u65b0\u5730\u5740\uff01")}else{f.find(".b p").html("\u606d\u559c\u60a8\uff0c\u5df2\u4fee\u6539\u6210\u529f\uff01")}f.setPosition()},onok:function(f){f.close()},onclose:function(){ec.member.myAddress.reset();ec.addr.list(ec.member.myAddress.list)}}).open()}});return false};ec.member.myAddress.edit=function(e){$("#myAddress-form #tel-msg").text("");var a,c=ec.member.myAddress.data[e],b=ec.member.myAddress.data.length;$("html,body").animate({scrollTop:$("#myAddress-edit").offset().top},200);$("#myAddress-form").removeAttr("data-type");$("#consignee").val(c.consignee);var d="";if(c.street!=""&&c.street!=null){d=c.street}else{d=c.district}ec.address.setValue(c);ec.address.queryData(ec.address.parseUrl(tree_url,d),true,1,ec.address.getCitydistrict);$("#id").val(c.id);$("#address").val(c.address);$("#address").prev("label").hide();$("#phone").prev("label").hide();$("#zipCode").val(c.zipCode);$("#mobile").val(c.mobile);$("#phone").val(c.phone);$("#button-ok").val("\u786e  \u5b9a");$("#button-cancel span").html("\u53d6&nbsp;&nbsp;\u6d88");if(c.id==ec.member.myAddress.defaultId){$("#myAddress-default").attr("checked",true).attr("disabled",true)}else{$("#myAddress-default").attr("checked",false).attr("disabled",false)}$("#myAddress-form input").removeClass("error");$("#myAddress-form label.label-error").removeClass("label-error");$("#myAddress-msg").removeClass("label-error");$("#myAddress-msg").hide();$("#address-msg").removeClass("label-error");$("#address-msg").html("");$("#address").removeClass("error");$("#needL4Addr").val(c.needL4Addr)};ec.member.myAddress.reset=function(){$("#myAddress-form")[0].reset();ec.address.setDefaultAddress();$("#myAddress-form").attr("data-type","add");$("#button-ok").val("\u6dfb\u52a0\u65b0\u5730\u5740");$("#button-cancel span").html("\u6e05&nbsp;&nbsp;\u7a7a");$("#myAddress-form input").removeClass("error");$("#myAddress-default").attr("checked",false).attr("disabled",false);$("#myAddress-form label.label-error").text("");$("#myAddress-form #tel-msg").text("");$("#myAddress-form label.label-error").removeClass("label-error");$("#myAddress-msg").removeClass("icon-error");$("#myAddress-msg").hide();ec.address.defaultTabValue();ec.address.cleanValue();$("#current-address").removeClass("form-address-detailcon").addClass("form-address-detail");ec.address.cleanFormValue()};ec.member.myAddress.del=function(a,b){if(!ec.ui.confirm(a,"\u60a8\u786e\u8ba4\u8981\u5220\u9664\u8be5\u5730\u5740\u5417\uff1f")){return}ec.addr.del(b,{deleteDefault:ec.member.myAddress.changeDefaultId,successFunction:function(c){$("#myAddress-area-"+c).remove()}})};ec.member.myAddress.setDefault=function(a){ec.addr.setDefault(a,{successFunction:ec.member.myAddress.changeDefaultId})};ec.member.myAddress.changeDefaultId=function(a){$("#myAddress-area-"+a).find(".p-state").html("<span class='default'>\u9ed8\u8ba4\u5730\u5740</span>");$("#myAddress-area-"+ec.member.myAddress.defaultId).find(".p-state").html('<a class="set " href="javascript:;" onclick="ec.member.myAddress.setDefault('+ec.member.myAddress.defaultId+')" title="\u8bbe\u4e3a\u9ed8\u8ba4\u6536\u8d27\u5730\u5740"><span>\u8bbe\u4e3a\u9ed8\u8ba4</span></a>');if(ec.member.myAddress.defaultId!=a){$("#address-form-"+ec.member.myAddress.defaultId+" input[name=defaultFlag]").attr("checked",false).attr("disabled",false)}ec.member.myAddress.defaultId=a};ec.member.myAddress.bind=function(){form=$("#myAddress-form");var g=ec.form.validator.bind,f=form.find("input[name=consignee]"),e=form.find("input[name=zipCode]"),c=form.find("textarea[name=address]"),b=form.find("input[name=phone]"),d=form.find("input[name=mobile]"),a=form.find("input[name=district]");checkPhone=function(i,h){var i=(i.attr("name")==="mobile")?d:b,j=$(h.msg_ct);if($.trim(d.val()).length==0){d.addClass("error");$("#tel-msg").addClass("label-error");$("#tel-msg").html("\u624b\u673a\u53f7\u7801\u4e0d\u80fd\u4e3a\u7a7a")}else{if($.trim(i.val()).length>0&&i.hasClass("error")){return}else{if(d.hasClass("error")){$("#tel-msg").text("\u8bf7\u586b\u5199\u6b63\u786e\u7684\u624b\u673a\u53f7\u7801")}if(b.hasClass("error")){$("#tel-msg").text("\u8bf7\u586b\u5199\u6b63\u786e\u7684\u5907\u9009\u53f7\u7801\uff0c\u56fa\u8bdd\u683c\u5f0f\u4e3a\u533a\u53f7-\u4e3b\u673a-\u5206\u673a\u53f7")}if(!d.hasClass("error")&&!b.hasClass("error")){$("#tel-msg").removeClass("label-error");$("#tel-msg").text("")}}}};currentCheckAddress=function(m,j){var i=$("#myAddress-form"),h=i.find("input[name=province]").val(),n=i.find("input[name=city]").val(),o=i.find("input[name=street]").val(),l=i.find("input[name=district]").val(),k=i.find("input[name=needL4Addr]").val();if($.trim($("#current-address").html())=="\u9009\u62e9\u7701-\u5e02-\u533a-\u8857\u9053"){$("#myAddress-msg").addClass("icon-error label-error");$("#myAddress-msg").html("\u8bf7\u586b\u5199\u5b8c\u6574\u7684\u5730\u533a\u4fe1\u606f")}else{if(""!=h&&""!=n&&""!=l){if(k=="true"&&o==""){$("#myAddress-msg").addClass("icon-error label-error");$("#myAddress-msg").html("\u8bf7\u586b\u5199\u5b8c\u6574\u7684\u5730\u533a\u4fe1\u606f")}else{$("#myAddress-msg").removeClass("icon-error");$("#myAddress-msg").removeClass("label-error");$("#myAddress-msg").html("")}}else{$("#myAddress-msg").removeClass("icon-error");$("#myAddress-msg").removeClass("label-error");$("#myAddress-msg").html("")}}};g(f,{type:["require","length","regex"],validOnChange:true,regex:/^[\u4E00-\u9FA5\s\u3000A-Za-z]+$/,min:2,max:20,msg_ct:"#"+f.attr("id")+"-msg",autoFocus:true,msg:{"default":"",length:"\u6536\u8d27\u4eba\u957f\u5ea6\u4e3a2-20\u4e2a\u5b57\u7b26\uff0c\u4e00\u4e2a\u6c49\u5b57\u4e3a\u4e24\u4e2a\u5b57\u7b26",regex:"\u6536\u8d27\u4eba\u53ea\u80fd\u586b\u5199\u4e2d\u6587\u548c\u82f1\u6587\u5b57\u7b26",require:"\u8bf7\u586b\u5199\u6536\u8d27\u4eba"}});g(a,{type:["addressCheck"],validOnChange:true,msg_ct:"#myAddress-msg",autoFocus:true,msg:{"default":"\u8bf7\u586b\u5199\u5b8c\u6574\u7684\u5730\u533a\u4fe1\u606f"},successFunction:currentCheckAddress});g(c,{type:["require","length","forbidChar2"],validOnChange:true,max:100,msg_ct:"#"+c.attr("id")+"-msg",autoFocus:true,msg:{forbidChar2:"\u6536\u8d27\u4eba\u8be6\u7ec6\u5730\u5740\u4e2d\u542b\u6709()\"'<>\u7b49\u975e\u6cd5\u5b57\u7b26",length:"\u8be6\u7ec6\u5730\u5740\u6700\u957f\u4e3a100\u4e2a\u5b57\u7b26\uff0c\u4e00\u4e2a\u6c49\u5b57\u4e3a\u4e24\u4e2a\u5b57\u7b26",require:"\u8bf7\u586b\u5199\u8be6\u7ec6\u5730\u5740"}});g(e,{type:["length","int"],validOnChange:true,min:6,max:6,msg_ct:"#"+e.attr("id")+"-msg",autoFocus:true,msg:{"default":"\u8bf7\u586b\u5199\u6b63\u786e\u7684\u90ae\u7f16"}});g(d,{type:["mobile"],validOnChange:true,msg_ct:"#"+d.attr("alt"),autoFocus:true,msg:{"default":"\u8bf7\u586b\u5199\u6b63\u786e\u7684\u624b\u673a\u53f7\u7801"},successFunction:checkPhone});g(b,{type:["mobleOrPhone"],validOnChange:true,msg_ct:"#"+b.attr("alt"),autoFocus:true,msg:{"default":"\u8bf7\u586b\u5199\u6b63\u786e\u7684\u5907\u9009\u53f7\u7801\uff0c\u56fa\u8bdd\u683c\u5f0f\u4e3a\u533a\u53f7-\u4e3b\u673a-\u5206\u673a\u53f7"},successFunction:checkPhone});ec.form.input.label(c,"\u5982\u9009\u62e9\u4e0d\u5230\u60a8\u7684\u5730\u533a\uff0c\u8bf7\u5728\u6b64\u5904\u8be6\u7ec6\u63cf\u8ff0").label(b,"\u56fa\u8bdd\u6216\u5176\u4ed6\u624b\u673a\u53f7\u7801\uff08\u5efa\u8bae\u586b\u5199\uff0c\u53cc\u91cd\u4fdd\u969c\u6536\u8d27\u66f4\u653e\u5fc3\uff09")};$.extend(ec.form.validator.defaults,{errorClass:"error",autoFocus:false,errorFunction:function(c,a){var b="label-error",d=a.msg[a.type]||a.msg["default"];d=(d.length<=0)?"&nbsp;":d;switch(a.type){case"require":b="label-error";break}if(a.msg_ct){$(a.msg_ct).addClass("label-error").html(d)}else{var e=(c.attr("id")||c.attr("name"))+"-msg";$("#"+e).remove();c.after("<label id='"+e+"' class='label-error "+b+"'>"+d+"</label>")}if(a.autoFocus){c.focus()}},successFunction:function(b,a){if(a.msg_ct){$(a.msg_ct).html("").removeClass("label-error")}else{$("#"+(b.attr("id")||b.attr("name"))+"-msg").remove()}}});ec.ready(function(){$("#li-myAddress").addClass("current");$("#pathTitle").html("\u6536\u8d27\u5730\u5740\u7ba1\u7406");ec.addr.list(ec.member.myAddress.list);if(ec.isIE6){$(".list-group-item").hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")})}ec.member.myAddress.bind();new ec.address.oSearchSuggest(ec.address.sendKeyWordToBack);$("#current-address").click(function(){if($("#gouldAddress").val()==0){ec.address.processAddress()}else{$("#address-search").show()}});$(".btn-address-close").click(function(){ec.address.hiddenTips()});$(".form-address-search-text a").click(function(){ec.address.cleanKeyWord()})});
